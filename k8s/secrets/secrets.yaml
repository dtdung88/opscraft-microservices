# NOTE: In production, use External Secrets Operator, Sealed Secrets,
# or HashiCorp Vault. Never commit actual secrets to version control.
# This file shows the structure - actual values should be injected at deploy time.
---
apiVersion: v1
kind: Secret
metadata:
  name: opscraft-secrets
  namespace: opscraft
  labels:
    app: opscraft
type: Opaque
stringData:
  # Database URLs - Replace with actual values at deploy time
  auth-database-url: "postgresql://postgres:REPLACE_ME@postgres:5432/auth_db"
  script-database-url: "postgresql://postgres:REPLACE_ME@postgres:5432/script_db"
  execution-database-url: "postgresql://postgres:REPLACE_ME@postgres:5432/execution_db"
  secret-database-url: "postgresql://postgres:REPLACE_ME@postgres:5432/secret_db"
  scheduler-database-url: "postgresql://postgres:REPLACE_ME@postgres:5432/scheduler_db"
  approval-database-url: "postgresql://postgres:REPLACE_ME@postgres:5432/approval_db"
  audit-database-url: "postgresql://postgres:REPLACE_ME@postgres:5432/audit_db"

  # Redis URL
  redis-url: "redis://:REPLACE_ME@redis:6379/0"

  # Celery
  celery-broker-url: "redis://:REPLACE_ME@redis:6379/5"
  celery-result-backend: "redis://:REPLACE_ME@redis:6379/6"

  # Security
  jwt-secret-key: "REPLACE_WITH_STRONG_SECRET_MIN_32_CHARS"
  encryption-key: "REPLACE_WITH_STRONG_SECRET_MIN_32_CHARS"

  # PostgreSQL
  postgres-password: "REPLACE_ME"

  # Optional integrations
  slack-webhook-url: ""
  smtp-host: ""
  smtp-username: ""
  smtp-password: ""
---
apiVersion: v1
kind: Secret
metadata:
  name: opscraft-tls
  namespace: opscraft
  labels:
    app: opscraft
type: kubernetes.io/tls
data:
  # Replace with base64-encoded TLS certificate and key
  tls.crt: ""
  tls.key: ""
---
# ServiceAccount for standard services
apiVersion: v1
kind: ServiceAccount
metadata:
  name: opscraft-service-account
  namespace: opscraft
  labels:
    app: opscraft
---
# ServiceAccount for execution services (may need additional permissions)
apiVersion: v1
kind: ServiceAccount
metadata:
  name: opscraft-execution-account
  namespace: opscraft
  labels:
    app: opscraft
---
# Role for standard services
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: opscraft-service-role
  namespace: opscraft
rules:
  - apiGroups: [""]
    resources: ["configmaps", "secrets"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get", "list"]
---
# RoleBinding for standard services
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: opscraft-service-rolebinding
  namespace: opscraft
subjects:
  - kind: ServiceAccount
    name: opscraft-service-account
    namespace: opscraft
roleRef:
  kind: Role
  name: opscraft-service-role
  apiGroup: rbac.authorization.k8s.io
---
# NetworkPolicy to restrict traffic
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: opscraft-network-policy
  namespace: opscraft
spec:
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: opscraft
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              name: opscraft
    - to:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
